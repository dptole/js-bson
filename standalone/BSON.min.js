-function(a){function d(a){if(!(this instanceof d))return new d(a);for(var b=[],c=0;c<a.length;b[c]=a.charCodeAt(c++));this.slice=function(b,c){return void 0!==b&&void 0!==c&&(c+=b),d(a.slice(b,c))},this.sliceWhile=function(a,b,c){for(now_sliced=null,sliced=[],slice=this.toArray(b,c);slice&&slice.length&&(now_sliced=slice.shift())&&a(now_sliced);sliced.push(now_sliced));return d(String.fromCharCode.apply(String,sliced))},this.toArray=function(a,c){return void 0!==a&&void 0!==c&&(c+=a),b.slice(a,c)}}function e(a){for(var b=0,c=0;b<a.length;)c+=a[b]*Math.pow(2,8*b++);return c-(a[a.length-1]>127&&(4===a.length||8===a.length)?Math.pow(2,8*a.length):0)}function f(a){var a=a.reverse(),b=a[0]>>7>0?-1:1,c=1023,d=0,e=256*(127&a[d++])+a[d++],f=15&e;for(e>>=4;void 0!==a[d];f=256*f+a[d++]);if(0===e)e=1-c;else{if(2047===e)return f?0/0:b*(1/0);f+=4503599627370496,e-=c}return a=a.reverse(),b*f*Math.pow(2,e-52)}function g(a,b){return this instanceof g?(this.toString=function(){return a},this.subtype=b,void 0):new g(a,b)}function h(a){return this instanceof h?(this.buffer=function(){return a.concat()},void 0):new h(a)}function i(a){if(!/^[-+]?\d+(\.\d+)?$/.test(a.toString()))throw new Error("Invalid number "+a);return this instanceof i?a instanceof i?a:("number"==typeof a&&(a=a.toString()),this.number=a,void 0):new i(a)}function j(a,b){var c=o(a,b),d=0;a=c[1],b=c[3];do{if(a[d]>b[d])return-1;if(b[d]>a[d])return 1}while(++d<a.length);return 0}function k(a,b){var c=o(a,b),d=[];return a=c[1],b=c[3],"-"===c[0]?"-"===c[2]?"-"+k(a,b):l(b,a):"-"===c[2]?l(a,b):(a=a.split("").reverse(),b=b.split("").reverse(),a.forEach(function(a,c){d.push(+(0|a)+ +(0|b[c])+ +(0|d[c-1]>9)),c&&d[c-1]>9&&(d[c-1]-=10)}),d[d.length-1]>9&&(d[d.length-1]-=10,d.push(1)),n("",d,c[4]))}function l(a,b){var c=[],d="",e=o(a,b);if(a=e[1],b=e[3],"-"===e[0])return"-"===e[2]?l(b,a):"-"+k(a,b);if("-"===e[2])return k(a,b);if(b>a){var f=b;b=a,a=f,d="-"}return a=a.split("").reverse(),b=b.split("").reverse(),a.forEach(function(d,e){d|=0,b[e]|=0,d-b[e]<0&&(d+=10,a[e+1]--),c.push(+d-b[e])}),n(d,c,e[4])}function m(a,b){var c=[],d="",e="0",f=o(a,b);return a=f[1].split("").reverse(),b=f[3].split("").reverse(),("-"===f[0]&&""===f[2]||""===f[0]&&"-"===f[2])&&(d="-"),a.forEach(function(a,d){for(b.forEach(function(b,d){c.push(+(0|a)*(0|b)+(c[d-1]>9?c[d-1]/10:0)>>0),d&&c[d-1]>9&&(c[d-1]%=10)});d-->0;)c.unshift(0);e=k(e,c.reverse().join("")),c=[]}),n(d,e.split("").reverse(),2*f[4])}function n(a,b,c){return b.reverse(),c?(b.splice(-c,0,"."),b=b.join("").replace(/0+$/,"")):b=b.join(""),a+b.replace(/^[0.]+|\.$/g,"")||"0"}function o(a,b){var c=a.match(q)&&RegExp.$1,d=b.match(q)&&RegExp.$1,e=a.split("."),f=b.split(".");for(1===e.length&&e.push(""),1===f.length&&f.push(""),first_int=e[0].replace(p,""),first_float=e[1],second_int=f[0].replace(p,""),second_float=f[1];first_float.length<second_float.length;)first_float+="0";for(;second_float.length<first_float.length;)second_float+="0";for(;first_int.length<second_int.length;)first_int="0"+first_int;for(;second_int.length<first_int.length;)second_int="0"+second_int;return[c,first_int+first_float,d,second_int+second_float,first_float.length]}function s(a,b){var c=[],d=[];if("object"==typeof b&&null!==b)for(var e in b)/arguments\[(\d+)\]/.exec(e)?d[RegExp.$1]=b[e]:c.push(e+" = "+b[e]);return c=c.length?"var "+c.join("\n  , ")+"\n;\n":"",d.push(c+a),Function.apply(Function,d)}function t(a){return t.core(a,Object.getOwnPropertyNames(a),"",0)}function u(a,c,d){var e=0,f=null,i=null,j=c?[]:{},k=a.readInt32LE(e),l=d instanceof Function;if(k!==a.length)throw new Error("BSON header error, got "+a.length+" but expected "+k+".");for(e+=4;k>e;){switch(i=a.pick(e++),f=c?c++-1:a.sliceWhile(function(a){return 0!==a},e).toArray().toUnicode(),e+=f.toString().length+1,i){case 0:break;case b.JS_CODE_W_S.D:var m=a.readInt32LE(e),n=e+4,o=a.readInt32LE(n),p=n+4,q=a.toArray(p,o-1).toUnicode(),r=p+q.length+1,t=a.readInt32LE(r),v=a.toArray(r,t).toUnicode(),w=BSON.decode(v);j[f]=s(q,w),e+=m;break;case b.JS_CODE.D:var o=a.readInt32LE(e),q=a.toArray(e+4,o-1).toUnicode();j[f]=Function(q),e+=o+4;break;case b.BINARY.D:case b.STRING.D:var x=e+4+(b.BINARY.D===i),y=a.readInt32LE(e)-(b.STRING.D===i);j[f]=a.toArray(x,y).toUnicode(),b.BINARY.D===i&&(j[f]=g(j[f],a.pick(e+4))),e+=j[f].length+4;break;case b.DOCUMENT.D:case b.ARRAY.D:var z=a.readInt32LE(e);j[f]=u(a.slice(e,z),b.ARRAY.D===i,d),e+=z-1;break;case b.BOOLEAN.D:j[f]=!!a.pick(e);break;case b.UNDEFINED.D:case b.NULL.D:j[f]=b.NULL.D===i?null:void 0,e--;break;case b.INT32.D:j[f]=a.readInt32LE(e,4),e+=3;break;case b.UTC_DATETIME.D:case b.DOUBLE.D:case b.INT64.D:j[f]=b.UTC_DATETIME.D===i?new Date(a.readInt64LE(e)):b.DOUBLE.D===i?a.readFloat64LE(e):new h(a.toArray(e,8)),e+=7;break;case b.REGEXP.D:var A=a.sliceWhile(function(a){return 0!==a},e).toArray(),B=a.sliceWhile(function(a){return 0!==a},e+A.length+1).toArray();j[f]=new RegExp(A.toUnicode(),B.toUnicode()),e+=A.length+B.length+1;break;default:if(l){var C=d(i,f,a.slice(e).toArray());if(C[0]<0)throw new Error("Fallback may not return negative numbers: "+C[0]);e+=C[0],j[C[1]]=C[2];continue}throw new Error("Unknown type "+i)}e++}return j}function v(a,b){0>b&&(4>=a?b=4294967296+b:8>=a&&(b=0x10000000000000000+b));for(var c=0,d=[];c++<a;d.push(255&b),b/=256);return String.fromCharCode.apply(String,d)}function w(a){return v(4,a)}function x(a){return v(8,a)}function y(a){var b=[],c=1023,d=2047,e=0>a?1:0,f=Math.abs(a),g=Math.floor(Math.log(f)/Math.LN2),h=11,i=0,j=52,k=Math.pow(2,-g);for(1>f*k&&(g--,k*=2),f*k>=2&&(g++,k/=2),g+c>=d?g=d:g+c>=1?(i=(f*k-1)*Math.pow(2,j),g+=c):(i=f*Math.pow(2,c-1)*Math.pow(2,j),g=0);j>=8;b.push(255&i),i/=256,j-=8);for(g=g<<j|i,h+=j;h>0;b.push(255&g),g/=256,h-=8);return b[7]|=128*e,b.toUnicode()}function z(a,c){return b.BOOLEAN.E+a+"\0"+(c?"":"\0")}function A(a,b){if(b.isNative())throw new Error("Cannot encode native function "+b.name+".");return b(a)}function B(a,c,d){return Number.isFinite(c)?-2147483648>c||c>2147483647?B.int64(a,c,d):~~c!==c?B.double64(a,c,d):B.int32(a,c,d):(d||b.DOUBLE.E)+a+"\0"+(isNaN(c)?"\0\0\0\0\0\xf0":"\0\0\0\0\0\0\xf0"+(c===1/0?"":"\xff"))}function C(a,c){if(c instanceof Array){for(var d=0,e={};d<c.length;d++)e[d]=c[d];return b.ARRAY.E+a+"\0"+t(e)}return c instanceof Date?b.UTC_DATETIME.E+a+"\0"+x(+c):null===c?b.NULL.E+a+"\0":c instanceof RegExp?""+b.REGEXP.E+a+"\0"+c.source+"\0"+(c.global?"g":"")+(c.ignoreCase?"i":"")+(c.multiline?"m":"")+"\0":b.DOCUMENT.E+a+"\0"+t(c)}function D(a,c,d){return(d||b.STRING.E)+a+"\0"+w(c.length+1)+c+"\0"}function E(a){return b.UNDEFINED.E+a+"\0"}var b={DOUBLE:{D:1,E:""},STRING:{D:2,E:""},DOCUMENT:{D:3,E:""},ARRAY:{D:4,E:""},BINARY:{D:5,E:"",GENERIC:{D:0,E:"\0"},FUNCTION:{D:1,E:""},BINARY:{D:2,E:""},UUID_OLD:{D:3,E:""},UUID:{D:4,E:""},MD5:{D:5,E:""}},UNDEFINED:{D:6,E:""},OBJECT_ID:{D:7,E:""},BOOLEAN:{D:8,E:"\b"},UTC_DATETIME:{D:9,E:"	"},NULL:{D:10,E:"\n"},REGEXP:{D:11,E:""},DB_POINTER:{D:12,E:"\f"},JS_CODE:{D:13,E:"\r"},DEPRECATED:{D:14,E:""},JS_CODE_W_S:{D:15,E:""},INT32:{D:16,E:""},TIMESTAMP:{D:17,E:""},INT64:{D:18,E:""},MIN_KEY:{D:255,E:"\xff"},MAX_KEY:{D:127,E:""}},c={"boolean":z,"function":A,number:B,object:C,undefined:E,string:D};d.prototype={constructor:d,get length(){return this.toArray().length},pick:function(a){return a=+a,this.toArray(a,a+1)[0]},readInt32LE:function(a){return e(this.toArray(a,4))},readInt64LE:function(a){return e(this.toArray(a,8))},readFloat64LE:function(a){return f(this.toArray(a,8))}},h.prototype={toString:function(){var a=this.buffer(),b=i(a[0].toString());return a[a.length-1]>>7&&b.subtract(r[a.length-1]),r.forEach(function(c,d){return void 0===a[d+1]?!1:(b.sum(i(c).multiply(a[d+1])),void 0)}),b.number},toNumber:function(){var a=this.buffer(),b=a[0],c=a.slice(1);return a[a.length-1]>>7&&(b-=Math.pow(2,8*a.length)),c.forEach(function(a,c){b+=a*Math.pow(2,8*(c+1))}),b}},i.prototype={constructor:i,number:"0",toNumber:function(){return+this.number},toString:function(){return this.number},sum:function(a){return this.number=k(this.toString(),a.toString()),this},subtract:function(a){return this.number=l(this.toString(),a.toString()),this},multiply:function(a){return this.number=m(this.toString(),a.toString()),this},compare:function(a){return j(this.toString(),a.toString())}},i.fromBuffer=function(a){if(4!==a.length&&8!==a.length)throw new Error("Invalid buffer length");var b=i(a[0].toString());return r.forEach(function(c,d){return void 0===a[d+1]?!1:(b.sum(i(c).multiply(a[d+1])),void 0)}),a[a.length-1]>>7&&b.subtract(r[a.length-1]),b};var p=/^([+-]?)/,q=/^(\-?)/,r=["256","65536","16777216","4294967296","1099511627776","281474976710656","72057594037927936","18446744073709551616"];Object.defineProperty(Array.prototype,"toUnicode",{value:function(){return String.fromCharCode.apply(String,this)},enumerable:!1,configurable:!1}),Object.defineProperty(Function.prototype,"isNative",{value:function(){return/function[^(]*\([^)]*\)[^{]*\{[^[]*\[native code\][^}]*\}/.test(""+this)},enumerable:!1,configurable:!1}),t.core=function(a,b,d,e){for(;e<b.length;e++)d+=c[typeof a[b[e]]](b[e],a[b[e]]);return w(d.length+5)+d+"\0"},B.int64=function(a,b,c){return B.double64(a,b,c)},B.int32=function(a,c,d){return(b.INT32.E||d)+a+"\0"+w(c)},B.double64=function(a,c,d){return(b.DOUBLE.E||d)+a+"\0"+y(c)},a.BSON={encode:function(a){return t(a)},decode:function(a,b){return u(d(a),!1,b)},get BINARY_TYPE(){return{UUID_OLD:b.BINARY.UUID_OLD.E,FUNCTION:b.BINARY.FUNCTION.E,GENERIC:b.BINARY.GENERIC.E,BINARY:b.BINARY.BINARY.E,UUID:b.BINARY.UUID.E,MD5:b.BINARY.MD5.E}},binary:function(a,c){return~[b.BINARY.FUNCTION.D,b.BINARY.UUID_OLD.D,b.BINARY.GENERIC.D,b.BINARY.BINARY.D,b.BINARY.UUID.D,b.BINARY.MD5.D].indexOf(c)||c>>7||(c=b.BINARY.GENERIC.D),c===b.BINARY.UUID_OLD.D?c=b.BINARY.UUID.D:c===b.BINARY.BINARY.D&&(c=b.BINARY.GENERIC.D),function(d){return""+b.BINARY.E+d+"\0"+w(a.length)+String.fromCharCode(255&c)+a}},jsFunction:function(a,b){var c=a.toString().match(/^function[^(]*\(([^)]*)\)/)[1].split(",");return BSON.jsCode(a.toString().replace(/^function[^(]*\([^)]*\)[^{]*\{|\}[^}]*$/g,""),b,c)},jsCode:function(a,c,d){return"function"!=typeof a?function(e){if(d instanceof Array)for(("object"!=typeof c||null===c)&&(c={});d.length;)c["arguments["+(d.length-1)+"]"]=d.pop();return void 0===c?D(e,a,b.JS_CODE.E):(c=BSON.encode(c),""+b.JS_CODE_W_S.E+e+"\0"+w(c.length+a.length+10)+w(a.length+1)+a+"\0"+c)}:this.jsFunction(a,c)},jsCodeWithScope:function(){return this.jsCode.apply(this,arguments)}},Object.freeze(a.BSON)}(this);
